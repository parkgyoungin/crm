{% extends 'base.html' %}
{% block style %}
<script src = "/static/js/my.js"></script>
<link rel="stylesheet" href="/static/js/mystyle.css">
{% endblock %}
{% block content %}
<style>
    table {width:100%;}
    table *{text-align:center;}
    thead {background-color:lightcyan;}
    td {height:50px;}
</style>
<div>
    {% include 'post/modal/filter.html' %}
    <a href="{% url 'post:list' 'ransomware_post'%}"><h3>랜섬웨어</h3></a>
    <h5>*Total : {{total}}</h5>
    <table class="t1">
        <thead>
        <tr>
            <td><a style="cursor:pointer" id="send_date" data-toggle="modal" data-target="#exampleModal">발송 날짜&#9660;</a></td>
            <td><a style="cursor:pointer" id="document_n" onclick="set_order_by(this)">문서번호&#9660;</a> </td>
            <td><a style="cursor:pointer" id="company" onclick="set_order_by(this)">기업명&#9660;</a> </td>
            <td><a style="cursor:pointer" id="path" onclick="set_order_by(this)">대상경로&#9660;</a></td>
            <td><a style="cursor:pointer" id="file_name" onclick="set_order_by(this)">파일명&#9660;</a></td>
            <td><a style="cursor:pointer" id="reply" onclick="set_order_by(this)">회신유무&#9660;</a></td>
            <td><a style="cursor:pointer" id="process_state" onclick="set_order_by(this)">처리상태&#9660;</a></td>
        </tr>
        </thead>
        <tbody>
        {% for object in objects %}
            <tr>
                <td><a href="#" onclick="location.href ='{% url 'post:detail' 'ransomware_post' object.id %}'">{{object.send_date}}</a></td>
                <td>{{object.document_n}}</td>
                <td> {{object.company}}</td>
                <td>{{object.path}}</td>
                <td>{{object.file_name}}</td>
                <td>{{object.reply}}</td>
                <td>{{object.process_state}}</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
</div>
<div>
{% if objects.has_other_pages %}
  <ul class="pagination">
    {% if objects.has_previous %}
      <li class="page-item"><a class="page-link" onclick="set_page({{objects.previous_page_number}})">처음</a></li>
    {% else %}
      <li class="page-item disabled"><a class="page-link"><span>처음</span></a></li>
    {% endif %}
    {% for i in objects.paginator.page_range %}
      {% if objects.number == i %}
        <li class="page-item active "><a class="page-link"><span>{{ i }} <span class="sr-only">(current)</span></span></a></li>
      {% else %}
        <li class="page-item"><a class="page-link" onclick="set_page({{i}})">{{ i }}</a></li>
      {% endif %}
    {% endfor %}
    {% if objects.has_next %}
      <li class="page-item"><a class="page-link" onclick="set_page({{objects.next_page_number}})">맨끝</a></li>
    {% else %}
      <li class="page-item disabled"><a class="page-link"><span>맨끝</span></a></li>
    {% endif %}
  </ul>
{% endif %}
</div>
<select name="search_field" onchange="set_">
    <option value="send_date">발송 날짜</option>
    <option value="document_n">문서번호</option>
    <option value="company">기업명</option>
    <option value="path">대상경로</option>
    <option value="file_name">파일명</option>
    <option value="reply">회신유무</option>
    <option value="process_state">처리상태</option>
</select>
<div>
    <form id="condition" action="" method="get">
        <input type="hidden" id="order_by" name="order_by" value="send_date">
        <input type="hidden" id="search_field" name="search_field" value="company">
        <input type="hidden" id="search_data" name="search_data" value="">
        <input type="hidden" id="date_start" name="date_start" value="2000-01-01">
        <input type="hidden" id="date_end" name="date_end" value="2100-01-01">
        <input type="hidden" id="page" name="page" value="1">
    </form>
</div>
<script>
    var form = document.getElementById('condition');
    window.onload = function(){
        set_btn_inner();
        set_request_get();
    }

    function set_btn_inner(){
        order_by = '{{request.GET.order_by}}';
        is_down = order_by[0] == "-";
        if(is_down)
            order_by = order_by.substr(1);
        ele = document.getElementById(order_by);
        inner = ele.innerHTML;
        inner = inner.substr(0, inner.length-1);
        if(is_down)
            ele.innerHTML = inner + '▼';
        else
            ele.innerHTML = inner + '▲';
    }

    function set_order_by(ele){
        document.getElementById('order_by').value = get_btn_value(ele);
        form.submit();
    }
    function set_page(i){
        document.getElementById('page').value = i;
        form.submit();
    }

    function set_request_get(){
        {% for key, val in request.GET.items %}
            document.getElementById('{{key}}').value = '{{val}}';
        {% endfor %}
    }



</script>
{% endblock %}